<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Page</title>

    <link rel = "stylesheet" type = "text/css" href="styles.css">
</head>

<body>
    <header>
        <img width = "100px" height = "100px" src = "images/coal.png" alt ="Company Logo" >
        <h2 id = 'company-name-align'>Jephora</h2>
    </header>
    <div class = 'navigation-bar'>
      
        <a href="index.html" class = "navigation-bar-link">Home</a>
     
        <a href = "products.html" class = "navigation-bar-link">Products</a>
     
        <a href = "contact.html"class = "navigation-bar-link">Contact</a>
       
    </div>
    <main>
        <!-- change below 
        <section class="login-form">
            <form action="#" method="post">
                <label for="username">Username:</label>
                <input type="text" id="username" name="username" required placeholder="Enter your username">

                <label for="password">Password:</label>
                <input type="password" id="password" name="password" required placeholder="Enter your password">

                <button type="submit" class="login-btn">Login</button>
                <p>Don't have an account? <a href="signup.html" class="signup-link">Sign up here</a>.</p>
            </form>
        </section>
      -->

        <section class="login-form">
            <form action="#" method = "post">
                <label for="username">Username:</label>
                <input type="text" id = "username" name = "username" required placeholder="Enter a username">

                <label for="password">Password:</label>
                <input type="password" id="password" name="password" required placeholder="Enter your password">
                
                <label for="checkPassword">Confirm Password:</label>
                <input type="password" id="checkPassword" name="checkPassword" required placeholder="Reenter your password">

                <label for="email">Email:</label>
                <input type="text" id="email" name="email" required placeholder="Enter your email">
                
                <button type="submit" class = "login-btn">Signup</button>
            </form>
        </section>
    </main>
    <footer>
        <p>Copyright: Julien Rabino, John Tumacder</p>
    </footer>
    <script>
        async function fetchUserData() {
            try{
                var result = await fetch(`https://jsonplaceholder.typicode.com/users`);
                var data = await result.json();
                return data;
            }
            catch{
                alert('API call was unsuccessful.');
            }
        }

        function createMessageDiv(){
            var messageBox = document.createElement('div');
            messageBox.id = 'messageBox';
            messageBox.style = "border:2px solid; background-color: #f9f9f9; padding: 10px; margin:2px;";
            var message = document.createElement('p');
            message.id = 'message';
            
            messageBox.appendChild(message);
            document.querySelector('main').appendChild(messageBox)
        }

        async function addNewUser(event){
            event.preventDefault();
            var userData = await fetchUserData();
            var username = document.querySelector('#username').value;

            var userValidCharacters = /^[-0-9a-zA-Z_]+$/;
            var userCheck = false;
            var cont = true;
            var errorMsgUser = "Check the username";
            var validUsername = false;

            if (username.length < 20 && username.length > 3){
                if (username[0].match(/^[a-zA-Z]+$/)){
                    for (var i = 1; i < username.length; i++){
                        var testing = username[i];
                        if(testing.match(userValidCharacters)&& cont == true){
                            userCheck = true;
                        } else {
                            userCheck = false;
                            cont = false;
                        }
                    }
                }else{
                    userCheck = false
                } 
            } else {
                userCheck = false;
                errorMsgUser = "Not in range"
            }
            if (userCheck == false){
                if (document.querySelector('#messageBox') == null){
                    createMessageDiv(); 
                    document.querySelector('#message').textContent = errorMsgUser;                        
                }else{
                    document.querySelector('#message').textContent = errorMsgUser;
                }
                return;
            }else{
                validUsername = true;
                if (document.querySelector('#messageBox') == null){
                    createMessageDiv(); 
                    document.querySelector('#message').textContent = null;                        
                }else{
                    document.querySelector('#message').textContent = null;
                }
            }

            var password = document.querySelector('#password').value;
            var checkPassword = document.querySelector('#checkPassword').value;
            var errorMsgPass = "Check password";
            var validPassword = false;
            var checkPass = false;
            if (password == checkPassword){
                if (password.length >= 8){
                    for (var i = 0; i < password.length; i++){
                        var testing = password[i];
                        if(testing.match(userValid)&& cont == true){
                            checkPass = true;
                            cont = true; 
                        } else if (/[!@#$%^&*()-_=+[]{}\|;:'",.<>\?\/`~]/.test(testing) && cont == true){
                            checkPass = true;
                            cont = true;
                        } else {
                            checkPass = false;
                            cont = false;
                        }
                    }
                }else{
                    checkPass = false;
                    errorMsgPass = "Password is too short";
                }
            } else {
                checkPass = false;
                errorMsgPass = "Passwords do not match " + password + " " + checkPassword;
            }
            if (checkPass == false){
                if (document.querySelector('#messageBox') == null){
                    createMessageDiv(); 
                    document.querySelector('#message').textContent = errorMsgPass + "test ";                        
                }else{
                    if (document.querySelector('#message') == null){
                        document.querySelector('#message').textContent = errorMsgPass;
                    }else {
                        document.querySelector('#message').textContent = document.querySelector('#message').textContent + errorMsgPass;
                    }
                }
            }else{
                validPassword = true;
            }

            var email = document.querySelector('#email').value;
            var errorMsgEmail = "Check email";
            var correctFormartEmail = false;
            var correctDomainEmail = false;
            var validEmail = false;

            var testingEmail = email;
            if (document.querySelector('#messageBox') == null){
                    createMessageDiv(); 
                    document.querySelector('#message').textContent = test;
            }else{
                document.querySelector('#message').textContent = testingEmail;
            }

            if (/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(email)){
                correctFormartEmail = true;
            }
            
            
            if (validUsername && validPassword && validEmail){
                if (document.querySelector('#messageBox') == null){
                    createMessageDiv(); 
                    document.querySelector('#message').textContent = "User has been created";                        
                }else{
                    document.querySelector('#message').textContent = "User has been created";
                }
            }
        }
        var user = document.querySelector(".login-form");
        user.addEventListener('submit', addNewUser);

        async function validateLogin(event){
            event.preventDefault();
            var userData = await fetchUserData();
            var username = document.querySelector('#username').value;
            var password = document.querySelector('#password').value;
            var counter = 0;
            
            userData.forEach(user => {
                if (user.username === username && user.email === password){
                    counter = 1;
                    if (document.querySelector('#messageBox') == null){
                        createMessageDiv();
                        
                        document.querySelector('#message').textContent = 'Login successful!';                        
                    }
                    else{
                        document.querySelector('#message').textContent = 'Login successful!';
                    }
                    }
                
            });

                if (counter == 0){
                    if (document.querySelector('#messageBox') == null){
                        createMessageDiv();
                        document.querySelector('#message').textContent = 'Username or User-email invalid. Try again.';                     
                    }
                    else{
                        document.querySelector('#message').textContent = 'Username or User-email invalid. Try again.';
                    }

                }
            
        }




    </script>


</body>
</html>